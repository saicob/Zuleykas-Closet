<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/styles.css">
    <title>Ver Productos</title>
    <!-- DataTables CSS -->
    <link rel="stylesheet" href="https://cdn.datatables.net/1.13.5/css/jquery.dataTables.min.css">

    <!-- jQuery y DataTables JS -->
    <script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.5/js/jquery.dataTables.min.js"></script>
</head>

<body>
    <section id="menú">
        <div class="rectangle">
            <header class="top-menu">
                <div class="logo">
                    <img src="/Zuleykas _Closet_logo.jpg" alt="Zuleyka's Closet Logo" style="height: 80px;">
                </div>
                <nav class="menu">
                    <ul>
                        <li class="dropdown">
                            <a href="#">Productos</a>
                            <ul class="dropdown-content">
                                <li><a href="VerProductos.html">Lista de Productos</a></li>
                                <li><a href="Marcas.html">Marcas</a></li>
                            </ul>
                        </li>
                        <li>
                            <a href="Proveedor.html" class="menu-button">Proveedores</a>
                        </li>
                        <li class="dropdown">
                            <a href="#">Ventas</a>
                            <ul class="dropdown-content">
                                <li><a href="Informe_de_Ventas.html">Informe de Ventas</a></li>
                                <li><a href="Rentabilidad.html">Rentabilidad</a></li>
                                <li><a href="Crear_venta.html">Crear Venta</a></li>
                            </ul>
                        </li>
                    </ul>
                </nav>
                <button class="logout-button">Cerrar Sesión</button>
            </header>
        </div>
        <div class="section-title-container">
            <div class="section-title">Lista de Productos</div>
        </div>
        <h1 class="outside-title">Zuleyka's Closet</h1>
        <p class="description-text">En este apartado podrá visualizar todos los productos registrados en el inventario.
            Además, tendrá la opción de agregar nuevos productos, actualizarlos y consultar su estado.</p>
    </section>

    <!-- Contenido central -->
    <main style="margin-left: center; padding: 20px; margin-top: calc(5% + 260px);">
        <section id="Ver_Productos" style="display: block;">
            <button id="mostrar-agregar-producto" class="action-button">
                Agregar Producto
            </button>
            <div style="overflow-x: auto;">
                <table id="productos-table" class="display"
                    style="width: 100%; min-width: 800px; border-collapse: collapse; background-color: white; box-shadow: 0px 4px 4px rgba(0, 0, 0, 0.25); border-radius: 16px; overflow: hidden;">
                    <thead style="background-color: #f9f9f9; border-bottom: 2px solid #ddd;">
                        <tr>
                            <th style="padding: 10px; text-align: left;">Imagen</th>
                            <th style="padding: 10px; text-align: left;">Nombre</th>
                            <th style="padding: 10px; text-align: left;">Descripción</th>
                            <th style="padding: 10px; text-align: left;">Precio</th>
                            <th style="padding: 10px; text-align: left;">Stock</th>
                            <th style="padding: 10px; text-align: left;">Categoría</th>
                            <th style="padding: 10px; text-align: left;">Talla</th>
                            <th style="padding: 10px; text-align: left;">Proveedor</th>
                            <th style="padding: 10px; text-align: left;">Marca</th>
                        </tr>
                    </thead>
                    <tbody id="productos-body" style="background-color: white; color: #333;">
                        <!-- Aquí se llenarán los datos de los productos -->
                    </tbody>
                </table>
            </div>
        </section>

        <!-- Modal Agregar Producto -->
        <section id="Agregar-Producto"
            style="display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background-color: white; padding: 20px; box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2); z-index: 1000; border-radius: 16px; width: 90vw; max-width: 800px; max-height: 90vh; overflow-y: auto;">
            <h2 style="font-family: 'Great Vibes', cursive; font-size: 24px; text-align: center; margin-bottom: 10px;">
                Registrar producto</h2>
            <p style="text-align: center; font-size: 14px; margin-bottom: 20px;">Registrar un nuevo producto</p>

            <form id="form-agregar-producto" enctype="multipart/form-data" method="POST">
                <!-- Primera fila: Nombre y Local -->
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                    <div class="form-group">
                        <label for="nombre">Nombre</label>
                        <input type="text" id="nombre" name="nombre" required>
                    </div>
                    <div class="form-group">
                        <label for="local">Local</label>
                        <select id="local" name="local">
                            <option value="1">1</option>
                            <option value="2">2</option>
                        </select>
                    </div>
                </div>

                <!-- Segunda fila: Imagen y campos del lado derecho -->
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                    <!-- Imagen -->
                    <div class="form-group" style="text-align: center;">
                        <label for="imagen">Seleccionar Imagen</label>
                        <div id="drop-area"
                            style="border: 1px dashed #ddd; border-radius: 8px; padding: 20px; text-align: center; position: relative; min-height: 150px; display: flex; flex-direction: column; justify-content: center;">
                            <input type="file" name="imagen" id="imagen" accept="image/*" style="display: none;">
                            <label for="imagen" id="label-imagen"
                                style="cursor: pointer; color: #999; display: block;">Sube una imagen o arrastra</label>
                            <img id="preview" src="/placeholder.svg"
                                style="max-width: 100px; display: none; margin: 10px auto;" />
                            <button type="button" id="quitarImagen"
                                style="display: none; position: absolute; top: 5px; right: 5px; background-color: red; color: white; border: none; border-radius: 50%; width: 24px; height: 24px; font-size: 14px; cursor: pointer;">✖</button>
                        </div>
                    </div>

                    <!-- Campos del lado derecho -->
                    <div style="display: grid; grid-template-rows: repeat(3, 1fr); gap: 15px;">
                        <div class="form-group">
                            <label for="proveedor-input-agregar">Proveedor</label>
                            <div style="display: flex; align-items: center; gap: 8px;">
                                <div class="autocomplete-marca-proveedor-container" style="flex: 1;">
                                    <input type="text" id="proveedor-input-agregar" name="proveedor" autocomplete="off"
                                        style="width: 100%;">
                                    <div id="proveedor-suggestions-agregar" class="suggestions-marca-proveedor"></div>
                                </div>
                                <button type="button" id="add-proveedor-btn-agregar" title="Agregar proveedor"
                                    style="background: none; border: none; font-size: 20px; cursor: pointer; flex-shrink: 0;">➕</button>
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="categoria">Categoría</label>
                            <select id="categoria" name="categoria">
                                <option value="Ropa">Ropa</option>
                                <option value="Accesorios">Accesorios</option>
                                <option value="Cosmetico">Cosmético</option>
                                <option value="Lencería">Lencería</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="marca-input-agregar">Marca</label>
                            <div style="display: flex; align-items: center; gap: 8px;">
                                <div class="autocomplete-marca-proveedor-container" style="flex: 1;">
                                    <input type="text" id="marca-input-agregar" name="marca" autocomplete="off"
                                        style="width: 100%;">
                                    <div id="marca-suggestions-agregar" class="suggestions-marca-proveedor"></div>
                                </div>
                                <button type="button" id="add-marca-btn-agregar" title="Agregar marca"
                                    style="background: none; border: none; font-size: 20px; cursor: pointer; flex-shrink: 0;">➕</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Tercera fila: Precios y cantidad -->
                <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                    <div class="form-group">
                        <label for="precio-compra">Precio de compra</label>
                        <input type="text" id="precio-compra" name="precio_compra">
                    </div>
                    <div class="form-group">
                        <label for="precio-venta">Precio de venta</label>
                        <input type="text" id="precio-venta" name="precio_venta">
                    </div>
                    <div class="form-group">
                        <label for="cantidad">Cantidad</label>
                        <input type="text" id="cantidad" name="cantidad">
                    </div>
                </div>

                <!-- Descripción -->
                <div class="form-group" style="margin-bottom: 20px;">
                    <label for="descripcion">Descripción</label>
                    <textarea id="descripcion" name="descripcion" rows="4"
                        style="resize: none; width: 100%;"></textarea>
                </div>

                <!-- Botones -->
                <div style="display: flex; justify-content: space-between; margin-top: 20px;">
                    <button type="button" id="Cancelar"
                        style="background-color: #f5f5f5; border: 1px solid #ddd; padding: 10px 20px; border-radius: 8px; cursor: pointer;">Cancelar</button>
                    <button type="submit" id="Agregar"
                        style="background-color: #f8a8b9; border: none; padding: 10px 20px; border-radius: 8px; cursor: pointer; color: white;">Registrar</button>
                </div>
            </form>
        </section>

        <!-- Modal Actualizar Producto -->
        <section id="Actualizar-Producto"
            style="display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background-color: white; padding: 20px; box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2); z-index: 1000; border-radius: 16px; width: 90vw; max-width: 800px; max-height: 90vh; overflow-y: auto;">
            <h2 style="font-family: 'Great Vibes', cursive; font-size: 24px; text-align: center; margin-bottom: 10px;">
                Actualizar producto</h2>
            <p style="text-align: center; font-size: 14px; margin-bottom: 20px;">Actualizar un producto existente</p>

            <form id="form-actualizar-producto" enctype="multipart/form-data">
                <!-- Primera fila: Nombre y Local -->
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                    <div class="form-group">
                        <label for="nombre-actualizar">Nombre</label>
                        <input type="text" id="nombre-actualizar" name="nombre" required>
                    </div>
                    <div class="form-group">
                        <label for="local-actualizar">Local</label>
                        <select id="local-actualizar" name="local">
                            <option value="1">1</option>
                            <option value="2">2</option>
                        </select>
                    </div>
                </div>

                <!-- Segunda fila: Imagen y campos del lado derecho -->
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                    <!-- Imagen -->
                    <div class="form-group" style="text-align: center;">
                        <label for="imagen-actualizar">Seleccionar Imagen</label>
                        <div id="drop-area-actualizar"
                            style="border: 1px dashed #ddd; border-radius: 8px; padding: 20px; text-align: center; position: relative; min-height: 150px; display: flex; flex-direction: column; justify-content: center;">
                            <input type="file" name="imagen" id="imagen-actualizar" accept="image/*"
                                style="display: none;">
                            <label for="imagen-actualizar" id="label-imagen-actualizar"
                                style="cursor: pointer; color: #999; display: block;">Sube una imagen o arrastra</label>
                            <img id="preview-actualizar" src="/placeholder.svg"
                                style="max-width: 100px; display: none; margin: 10px auto;" />
                            <button type="button" id="quitarImagen-actualizar"
                                style="display: none; position: absolute; top: 5px; right: 5px; background-color: red; color: white; border: none; border-radius: 50%; width: 24px; height: 24px; font-size: 14px; cursor: pointer;">✖</button>
                        </div>
                    </div>

                    <!-- Campos del lado derecho -->
                    <div style="display: grid; grid-template-rows: repeat(3, 1fr); gap: 15px;">
                        <div class="form-group">
                            <label for="proveedor-input-actualizar">Proveedor</label>
                            <div style="display: flex; align-items: center; gap: 8px;">
                                <div class="autocomplete-marca-proveedor-container" style="flex: 1;">
                                    <input type="text" id="proveedor-input-actualizar" name="proveedor"
                                        autocomplete="off" style="width: 100%;">
                                    <div id="proveedor-suggestions-actualizar" class="suggestions-marca-proveedor">
                                    </div>
                                </div>
                                <button type="button" id="add-proveedor-btn-actualizar" title="Agregar proveedor"
                                    style="background: none; border: none; font-size: 20px; cursor: pointer; flex-shrink: 0;">➕</button>
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="categoria-actualizar">Categoría</label>
                            <select id="categoria-actualizar" name="categoria">
                                <option value="Ropa">Ropa</option>
                                <option value="Accesorios">Accesorios</option>
                                <option value="Cosmetico">Cosmético</option>
                                <option value="Lencería">Lencería</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="marca-input-actualizar">Marca</label>
                            <div style="display: flex; align-items: center; gap: 8px;">
                                <div class="autocomplete-marca-proveedor-container" style="flex: 1;">
                                    <input type="text" id="marca-input-actualizar" name="marca" autocomplete="off"
                                        style="width: 100%;">
                                    <div id="marca-suggestions-actualizar" class="suggestions-marca-proveedor"></div>
                                </div>
                                <button type="button" id="add-marca-btn-actualizar" title="Agregar marca"
                                    style="background: none; border: none; font-size: 20px; cursor: pointer; flex-shrink: 0;">➕</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Tercera fila: Precios y cantidad -->
                <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                    <div class="form-group">
                        <label for="precio-compra-actualizar">Precio de compra</label>
                        <input type="text" id="precio-compra-actualizar" name="precio_compra">
                    </div>
                    <div class="form-group">
                        <label for="precio-venta-actualizar">Precio de venta</label>
                        <input type="text" id="precio-venta-actualizar" name="precio_venta">
                    </div>
                    <div class="form-group">
                        <label for="cantidad-actualizar">Cantidad</label>
                        <input type="text" id="cantidad-actualizar" name="cantidad">
                    </div>
                </div>

                <!-- Descripción -->
                <div class="form-group" style="margin-bottom: 20px;">
                    <label for="descripcion-actualizar">Descripción</label>
                    <textarea id="descripcion-actualizar" name="descripcion" rows="4"
                        style="resize: none; width: 100%;"></textarea>
                </div>

                <!-- Botones -->
                <div style="display: flex; justify-content: space-between; margin-top: 20px;">
                    <button type="button" id="Cancelar-Actualizar"
                        style="background-color: #f5f5f5; border: 1px solid #ddd; padding: 10px 20px; border-radius: 8px; cursor: pointer;">Cancelar</button>
                    <button type="submit" id="Actualizar"
                        style="background-color: #f8a8b9; border: none; padding: 10px 20px; border-radius: 8px; cursor: pointer; color: white;">Actualizar</button>
                </div>
            </form>
        </section>

        <div id="overlay"
            style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.5); z-index: 999;">
        </div>

        <!-- Secciones para agregar marca y proveedor -->
        <section id="Agregar-Marca"
            style="display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background-color: white; padding: 20px; box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2); z-index: 1001; border-radius: 16px; width: 90vw; max-width: 600px;">
            <h2 style="font-family: 'Great Vibes', cursive; font-size: 24px; text-align: center; margin-bottom: 10px;">
                Agregar Marca</h2>
            <p style="text-align: center; font-size: 14px; margin-bottom: 20px;">Registrar una nueva marca</p>
            <form id="agregar-marca-form">
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                    <div class="form-group">
                        <label for="nombre">Nombre</label>
                        <input type="text" name="nombre" required>
                    </div>
                    <div class="form-group">
                        <label for="estado">Estado</label>
                        <select name="estado" required>
                            <option value="Activo">Activo</option>
                            <option value="Inactivo">Inactivo</option>
                        </select>
                    </div>
                </div>
                <div style="display: flex; justify-content: space-between; margin-top: 20px;">
                    <button type="button" id="Cancelar"
                        style="background-color: #f5f5f5; border: 1px solid #ddd; padding: 10px 20px; border-radius: 8px; cursor: pointer;">Cancelar</button>
                    <button type="submit"
                        style="background-color: #f8a8b9; border: none; padding: 10px 20px; border-radius: 8px; cursor: pointer; color: white;">Agregar</button>
                </div>
            </form>
        </section>

        <section id="Agregar-Proveedor"
            style="display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background-color: white; padding: 20px; box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2); z-index: 1001; border-radius: 16px; width: 90vw; max-width: 600px;">
            <h2 style="font-family: 'Great Vibes', cursive; font-size: 24px; text-align: center; margin-bottom: 10px;">
                Agregar Proveedor</h2>
            <p style="text-align: center; font-size: 14px; margin-bottom: 20px;">Registrar un nuevo proveedor</p>
            <form id="agregar-proveedor-form">
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                    <div class="form-group">
                        <label for="nombre">Nombre</label>
                        <input type="text" name="nombre" required>
                    </div>
                    <div class="form-group">
                        <label for="estado">Estado</label>
                        <select name="estado" required>
                            <option value="Activo">Activo</option>
                            <option value="Inactivo">Inactivo</option>
                        </select>
                    </div>
                </div>
                <div style="display: flex; justify-content: space-between; margin-top: 20px;">
                    <button type="button" id="Cancelar"
                        style="background-color: #f5f5f5; border: 1px solid #ddd; padding: 10px 20px; border-radius: 8px; cursor: pointer;">Cancelar</button>
                    <button type="submit"
                        style="background-color: #f8a8b9; border: none; padding: 10px 20px; border-radius: 8px; cursor: pointer; color: white;">Agregar</button>
                </div>
            </form>
        </section>
    </main>

    <script src="/script.js"></script>
    <script src="/autocompletar_productomarca.js"></script>
    <script src="/autocompletar_productoproveedor.js"></script>
    <script src="/agregar_productomarca.js"></script>
    <script src="/agregar_productoproveedor.js"></script>
    <script src="/cargarimagenes.js"></script>

    <script>
        $(document).ready(function () {
            const agregarProductoSection = $('#Agregar-Producto');
            const actualizarProductoSection = $('#Actualizar-Producto');
            const overlay = $('#overlay');
            let tablaInicializada = false;
            let currentProductId = null;

            // Inicializar DataTable una sola vez
            function inicializarTabla() {
                if (tablaInicializada) return;

                const table = $('#productos-table').DataTable({
                    scrollX: true,
                    scrollY: "400px",
                    scrollCollapse: true,
                    processing: true,
                    deferRender: true,
                    responsive: true,
                    ajax: {
                        url: 'http://localhost:3000/api/products',
                        dataSrc: '',
                        cache: true,
                        error: function (xhr, error, thrown) {
                            console.error('Error al cargar productos:', error, thrown);
                            alert('No se pudieron cargar los productos. Verifica que el servidor esté corriendo.');
                        }
                    },
                    columns: [
                        {
                            data: 'imagen',
                            render: function (data, type, row) {
                                if (type === 'display') {
                                    const imgSrc = data || '/placeholder.svg?height=50&width=50';
                                    return `<img src="${imgSrc}" alt="${row.nombre}" style="width: 50px; height: 50px; object-fit: cover; border-radius: 4px; background: #f5f5f5;" loading="lazy" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';" onload="this.style.display='block'; if(this.nextElementSibling) this.nextElementSibling.style.display='none';"><div style="display: none; width: 50px; height: 50px; background: #f5f5f5; border-radius: 4px; align-items: center; justify-content: center; font-size: 12px; color: #999;">Sin imagen</div>`;
                                }
                                return data;
                            }
                        },
                        { data: 'nombre' },
                        {
                            data: 'descripcion',
                            render: function (data) {
                                return data && data.length > 50 ? data.substring(0, 50) + '...' : (data || 'Sin descripción');
                            }
                        },
                        {
                            data: 'precio',
                            render: function (data) {
                                return `$${parseFloat(data || 0).toFixed(2)}`;
                            }
                        },
                        { data: 'stock' },
                        { data: 'categoria' },
                        {
                            data: 'talla',
                            render: function (data) {
                                return data || 'N/A';
                            }
                        },
                        { data: 'proveedor' },
                        { data: 'marca' }
                    ],
                    language: {
                        search: "Buscar:",
                        lengthMenu: "Mostrar _MENU_ registros",
                        info: "Mostrando _START_ a _END_ de _TOTAL_ productos",
                        paginate: {
                            first: "Primero",
                            last: "Último",
                            next: "Siguiente",
                            previous: "Anterior"
                        },
                        emptyTable: "No hay productos registrados",
                        loadingRecords: "Cargando productos...",
                        processing: "Procesando..."
                    }
                });

                tablaInicializada = true;
                return table;
            }

            // Inicializar tabla al cargar la página
            const table = inicializarTabla();

            // Mostrar sección Agregar Producto
            $('#mostrar-agregar-producto').on('click', function () {
                agregarProductoSection.show();
                overlay.show();
            });

            // Cancelar Agregar
            $('#Agregar-Producto #Cancelar').on('click', function () {
                $('#form-agregar-producto')[0].reset();
                agregarProductoSection.hide();
                overlay.hide();
            });

            // Cancelar Actualizar
            $('#Cancelar-Actualizar').on('click', function () {
                $('#form-actualizar-producto')[0].reset();
                actualizarProductoSection.hide();
                overlay.hide();
            });

            // Mostrar formulario de actualización al hacer clic en una fila
            $('#productos-table tbody').on('click', 'tr', async function () {
                const data = table.row(this).data();
                if (data) {
                    try {
                        const response = await fetch(`http://localhost:3000/api/products/${data.nombre}`);
                        if (response.ok) {
                            const product = await response.json();

                            // Rellenar el formulario con los datos del producto
                            $('#nombre-actualizar').val(product.nombre);
                            $('#proveedor-input-actualizar').val(product.proveedor || '');
                            $('#precio-compra-actualizar').val(product.precio_compra || '');
                            $('#precio-venta-actualizar').val(product.precio || '');
                            $('#cantidad-actualizar').val(product.stock || '');
                            $('#descripcion-actualizar').val(product.descripcion || '');
                            $('#local-actualizar').val(product.codigo_tienda || '1');
                            $('#categoria-actualizar').val(product.categoria || '');
                            $('#marca-input-actualizar').val(product.marca || '');

                            currentProductId = data.codigo_producto;

                            // Mostrar el formulario de actualización
                            actualizarProductoSection.show();
                            overlay.show();
                        } else {
                            alert('Error al obtener los detalles del producto');
                        }
                    } catch (error) {
                        console.error('Error al obtener los detalles del producto:', error);
                        alert('Error al cargar los datos del producto');
                    }
                }
            });

            // Manejar envío del formulario de actualización
            $('#form-actualizar-producto').on('submit', async function (event) {
                event.preventDefault();

                if (!currentProductId) {
                    alert('Error: No se ha seleccionado un producto para actualizar');
                    return;
                }

                const formData = {
                    nombre: $('#nombre-actualizar').val(),
                    descripcion: $('#descripcion-actualizar').val(),
                    precio_compra: $('#precio-compra-actualizar').val(),
                    precio_venta: $('#precio-venta-actualizar').val(),
                    cantidad: $('#cantidad-actualizar').val()
                };

                try {
                    const response = await fetch(`http://localhost:3000/api/products/${currentProductId}`, {
                        method: 'PUT',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(formData)
                    });

                    if (response.ok) {
                        alert('Producto actualizado exitosamente');
                        $('#form-actualizar-producto')[0].reset();
                        actualizarProductoSection.hide();
                        overlay.hide();
                        table.ajax.reload();
                    } else {
                        alert('Error al actualizar el producto');
                    }
                } catch (error) {
                    console.error('Error:', error);
                    alert('Error al conectar con el servidor');
                }
            });

            // Botones + para agregar proveedor y marca desde formulario de actualización
            $('#add-proveedor-btn-actualizar').on('click', function () {
                $('#Agregar-Proveedor').show();
                overlay.show();
            });

            $('#add-marca-btn-actualizar').on('click', function () {
                $('#Agregar-Marca').show();
                overlay.show();
            });

            // Botones + para agregar proveedor y marca desde formulario de agregar
            $('#add-proveedor-btn-agregar').on('click', function () {
                $('#Agregar-Proveedor').show();
                overlay.show();
            });

            $('#add-marca-btn-agregar').on('click', function () {
                $('#Agregar-Marca').show();
                overlay.show();
            });

            // Cancelar formularios de agregar marca/proveedor
            $('#Agregar-Proveedor #Cancelar, #Agregar-Marca #Cancelar').on('click', function (event) {
                event.preventDefault();
                $(this).closest('form')[0].reset();
                $(this).closest('section').hide();
                overlay.hide();
            });

            // Refrescar tabla después de agregar producto
            window.refrescarTablaProductos = function () {
                if (tablaInicializada) {
                    $('#productos-table').DataTable().ajax.reload(null, false);
                }
            };
        });
    </script>
</body>

</html>